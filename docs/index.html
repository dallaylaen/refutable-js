<html>
<head>
    <meta charset="utf-8"/>
    <title>Refute.js playground</title>
    <link rel="shortcut icon" type="image/gif" href="favicon.ico">
    <script src="js/refute.js"></script>
</head>
<body>
    <h1>Refute.js playground</h1>
    This is a demo page of
    <a href="https://github.com/dallaylaen/refute-js">refute.js</a> project.
    Edit code below, then press Run!
    <div id="cons" style="height: 10em; overflow:scroll"></div>
    <textarea rows="8" style="width: 100%" name="code" id="code"></textarea>
<button onclick="return run()">Run!</button>
<script>
    function out(text, color='black') {
        const canvas = document.createElement('pre');
        canvas.style.color = color;
        canvas.style.border = 'solid 1px red';
        const container = document.getElementById('cons');
        container.appendChild(canvas);
        canvas.innerHTML = text; // TODO insecure
        container.scrollTop = canvas.offsetTop;
    };

    const code = document.getElementById('code');

    function run() {
        const src = code.value;
        out( src, 'blue' );
        try {
            const action = Function('"use strict";return '+src)();
            const report = new refute.Report();
            action(report);
            out( report.getText() );
        } catch(e) {
            out(e, 'red');
        };
    };

    if (!code.value.match(/\S/))
        code.value =
`ok => {
    ok.equal( 42, 137, 'life is fine' );
    ok.deepEqual( { foo: [ 'bar', 1 ] }, { foo: [ 'bar', 2 ] } );
    ok.equal( 2+2, 4, "at least something works" );
}`;

    out("your output goes here", "green");
</script>
</body>
</html>
