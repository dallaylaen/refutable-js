!function(){"use strict";const t=/([^:\s()]+:\d+(?::\d+)?)\W*(\n|$)/g;var n,e={callerInfo:function(n){return(new Error).stack.match(t)[n+1].replace(/\W*\n$/,"")||""},explain:function(t,n={}){return function t(n,e,r,i=new Map){if("string"==typeof n)return JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n||null===n)return""+n;if(void 0===n)return"<undef>";if("object"!=typeof n)return""+n;if(i.has(n)){const t="Circular="+i.get(n);return Array.isArray(n)?"[ "+t+" ]":"{ "+t+" }"}try{if(i.set(n,r),Array.isArray(n)){if(e<1)return"[...]";return"["+n.map((n,o)=>t(n,e-1,r+"["+o+"]",i)).join(", ")+"]"}const o=n.constructor&&n.constructor.name,s=o&&"Object"!==o?o+" ":"";if(e<1)return s+"{...}";return s+"{"+Object.keys(n).sort().map(o=>{const s=JSON.stringify(o);return s+":"+t(n[o],e-1,r+"["+s+"]",i)}).join(", ")+"}"}finally{i.delete(n)}}(t,n.depth||3,n.path||"$")}};const{callerInfo:r,explain:i}=e;class o{constructor(){this._count=0,this._failCount=0,this._descr=[],this._evidence=[],this._where=[],this._condName=[],this._info=[],this._nested=[],this._pending=new Set,this._onDone=[],this._done=!1}onDone(t){if("function"!=typeof t)throw new Error("onDone(): callback must be a function");return this._lock(),this._onDone.push(t),this}onFail(t){if("function"!=typeof t)throw new Error("onDone(): callback must be a function");return this._lock(),this._onDone.push(n=>n.getPass()||t(n)),this}run(...t){this._lock();const n=t.pop();if("function"!=typeof n)throw new Error("Last argument of run() must be a function, not "+typeof n);const e=n(this,...t);return e instanceof Promise?e.then(()=>this.done()):this.done(),this}runSync(...t){this._lock();const n=t.pop();if("function"!=typeof n)throw new Error("Last argument of run() must be a function, not "+typeof n);return n(this,...t),this}setResult(t,n,e,i){this._lock();const s=++this._count;if(n&&(this._descr[s]=n),t){if(t instanceof o)if(this._nested[s]=t,t.getDone()){if(t.getPass())return;t=[]}else{const n=t;t=new Promise((t,e)=>{n.onDone(t)})}return t instanceof Promise?(this._pending.add(s),i=i||r(2),void t.then(t=>{if(this._pending.delete(s),this._setResult(s,t,e,i),this.getDone())for(let n=this._onDone.length;n-- >0;)this._onDone[n](this)})):this._setResult(s,t,e,i||r(2))}}_setResult(t,n,e,r){n&&(Array.isArray(n)||(n=[n]),this._evidence[t]=n.map(t=>s(t,1/0)),this._where[t]=r,this._condName[t]=e,this._failCount++)}info(...t){return this._lock(),this._info[this._count]||(this._info[this._count]=[]),this._info[this._count].push(t.map(t=>s(t)).join(" ")),this}done(t){if(void 0!==t&&this.onDone(t),!this._done&&(this._done=!0,!this._pending.size))for(let n=this._onDone.length;n-- >0;)this._onDone[n](this);return this}_lock(){if(this._done)throw new Error("Attempt to modify a finished contract")}getDone(){return this._done&&!this._pending.size}getPass(t){return void 0===t?0===this._failCount:t>0&&t<=this._count?!this._evidence[t]:void 0}getCount(){return this._count}last(){return this._count?!this._evidence[this._count]:void 0}getFailCount(){return this._failCount}getGhost(){const t=[];let n=0;for(let e=1;e<=this._count;e++)this._evidence[e]||this._nested[e]?(n&&t.push(n),n=0,t.push(this._nested[e]?this._nested[e].getGhost():"N")):n++;return n&&t.push(n),"r("+t.join(",")+")"}toString(){return"refute/1.1\n"+this.getLines().join("\n")}getLines(t=""){const n=[t+"r("],e=t+")";t+="    ";const r=n=>e=>t+n+" "+e;this._info[0]&&n.push(...this._info[0].map(r(";")));for(let i=1;i<=this._count;i++)n.push(...this.getLinesPartial(i,t)),this._info[i]&&n.push(...this._info[i].map(r(";")));return n.push(e),n}getLinesPartial(t,n=""){const e=[];return e.push(n+(this._pending.has(t)?"...":this._evidence[t]?"!":"")+t+(this._descr[t]?". "+this._descr[t]:".")),this._nested[t]?e.push(...this._nested[t].getLines(n)):this._evidence[t]&&(e.push(n+"    ^ Condition `"+(this._condName[t]||"check")+"` failed at "+this._where[t]),this._evidence[t].forEach(t=>{let[r,i,o]=t.match(/^([-+|] )?(.*?)\n?$/s);i||(i="| "),o.match(/\n/)?o.split("\n").forEach(t=>e.push(n+"    "+i+t)):e.push(n+"    "+i+o)})),e}toJSON(){const t=this.getCount(),n=[];for(let e=0;e<=t;e++){const t=this.getDetails(e);for(const n in t)(void 0===t[n]||Array.isArray(t[n])&&0===t[n].length)&&delete t[n];n.push(t)}return{pass:this.getPass(),count:this.getCount(),details:n}}getDetails(t){if(0===t)return{n:0,info:this._info[0]||[]};let n=this._evidence[t];return n&&!Array.isArray(n)&&(n=[n]),{n:t,name:this._descr[t]||"",pass:!n,evidence:n||[],where:this._where[t],cond:this._condName[t],info:this._info[t]||[],nested:this._nested[t],pending:this._pending.has(t)}}}function s(t,n){return"string"==typeof t?t:i(t,{depth:n})}o.prototype.explain=i,o.protocol=1.1;const h=new Set;function u(t,n,e){if("string"!=typeof t)throw new Error("Condition name must be a string");if(t.match(/^(_|get[_A-Z]|set[_A-Z])/))throw new Error("Condition name must not start with get_, set_, or _");if(!h.has(t)&&o.prototype[t])throw new Error("Method already exists in Report: "+t);if("object"!=typeof n)throw new Error("bad options");if("function"!=typeof e)throw new Error("bad implementation");const r=n.minArgs||n.args;if(!Number.isInteger(r)||r<0)throw new Error("args/minArgs must be nonnegative integer");const i=n.maxArgs||n.args||1/0;if(i!==1/0&&(!Number.isInteger(r)||i<r))throw new Error("maxArgs must be integer and greater than minArgs, or Infinity");const s=n.descrFirst||n.fun||i>10,u=!!n.hasOptions,f=i+(u?1:0);h.add(t),o.prototype[t]=function(...n){const o=s?n.shift():n.length>i&&"string"==typeof n[n.length-1]?n.pop():void 0;if(n.length>f||n.length<r)throw new Error("Condition "+t+" must have "+r+".."+f+" arguments ");return this.setResult(e(...n),o,t)}}u("check",{args:1},t=>t),u("pass",{args:0},()=>0),u("fail",{args:0},()=>"failed deliberately"),u("equal",{args:2},(t,n)=>t===n?0:["- "+i(t),"+ "+i(n)]),u("match",{args:2},(t,n)=>null==t?[""+t,"Does not match : "+n]:(""+t).match(n)?0:["String         : "+t,"Does not match : "+n]),u("nested",{fun:1,minArgs:1},(...t)=>(new o).run(...t).done()),n={Report:o,addCondition:u,explain:i};const{addCondition:f,explain:a}=n,c={"<":(t,n)=>t<n,">":(t,n)=>t>n,"<=":(t,n)=>t<=n,">=":(t,n)=>t>=n,"==":(t,n)=>t===n,"!=":(t,n)=>t!==n},d={"<":(t,n)=>null!=t&&null!=n&&""+t<""+n,">":(t,n)=>null!=t&&null!=n&&""+t>""+n,"<=":(t,n)=>null!=t&&null!=n&&""+t<=""+n,">=":(t,n)=>null!=t&&null!=n&&""+t>=""+n,"==":(t,n)=>null!=t&&null!=n&&""+t==""+n,"!=":(t,n)=>null==t^null==n||""+t!=""+n};f("cmpNum",{args:3},(t,n,e)=>c[n](t,e)?0:[t,"is not "+n,e]),f("cmpStr",{args:3},(t,n,e)=>d[n](t,e)?0:[t,"is not "+n,e]);const l={undefined:t=>void 0===t,null:t=>null===t,number:t=>"number"==typeof t&&!Number.isNaN(t),integer:t=>Number.isInteger(t),nan:t=>Number.isNaN(t),string:t=>"string"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,object:t=>t&&"object"==typeof t&&!Array.isArray(t),array:t=>Array.isArray(t)};function p(t){return"string"==typeof t?t:"function"==typeof t?"instanceof "+(t.name||t):void 0}f("type",{args:2},(t,n)=>{Array.isArray(n)||(n=[n]);for(const e of n)if("string"==typeof e&&l[e]){if(l[e](t))return!1}else{if("function"!=typeof e||"object"!=typeof t)return"unknown value type spec: "+a(e,1);if(t instanceof e)return!1}return["- "+a(t,1),"+ "+n.map(p).join(" or ")]});const{addCondition:g,Report:_}=n;g("forEach",{fun:1,args:2},(t,n)=>{if(!Array.isArray(t))return"Expected a list, found a ".typeof(t);if(t.length<1)return 0;const e=new _;return t.forEach((t,r)=>e.nested("item "+r,t,n)),e.done()}),g("ordered",{fun:1,args:2},(t,n)=>{if(!Array.isArray(t))return"Expected a list, found a ".typeof(t);if(t.length<2)return 0;const e=new _;for(let r=0;r<t.length-1;r++)e.nested("items "+r+", "+(r+1),t[r],t[r+1],n);return e.done()});const{addCondition:y,explain:m}=n;function w(t,n){return"number"==typeof n?t+"["+n+"]":n.match(/^[a-z_][a-z_0-9]*$/i)?t+"."+n:t+"["+JSON.stringify(n)+"]"}y("deepEqual",{args:2,hasOptions:!0},(function(t,n,e={}){if(e.max||(e.max=5),e.diff=[],function t(n,e,r={},i="$",o=new Map,s=new Map){if(n===e||r.max<=r.diff.length)return;if(typeof n!=typeof e)return r.diff.push([i,n,e]);if("object"!=typeof e||null===e)return r.diff.push([i,n,e]);const h=o.get(n),u=s.get(e);if(h||u){if(h===u)return;return r.diff.push([i+" (circular)",h?"Circular="+h:m(n,{depth:2}),u?"Circular="+u:m(e,{depth:2}),!0])}try{if(o.set(n,i),s.set(e,i),n.constructor!==e.constructor)return r.diff.push([i,n,e]);if(Array.isArray(e)){if(!Array.isArray(n)||n.length!==e.length)return r.diff.push([i,n,e]);for(let h=0;h<e.length&&(t(n[h],e[h],r,w(i,h),o,s),!(r.max<=r.diff.length));h++);return}const h={};Object.keys(e).forEach(t=>{h[t]=1}),Object.keys(n).forEach(t=>{h[t]=(h[t]||0)-1});for(const t in h)if(0!==h[t])return r.diff.push([i,n,e]);for(const u in e)if(t(n[u],e[u],r,w(i,u),o,s),r.max<=r.diff.length)break}finally{o.delete(n),s.delete(e)}}(t,n,e),!e.diff.length)return 0;const r=[];for(const i of e.diff)r.push("at "+i[0],"- "+(i[3]?i[1]:m(i[1],{depth:2})),"+ "+(i[3]?i[2]:m(i[2],{depth:2})));return r}));const{Report:b,addCondition:A,explain:v}=n,E=(...t)=>(new b).run(...t).done();var C=function t(n={},e){const r=n.onFail||(t=>{throw new Error(t.toString())}),i=n.skip?()=>{}:(...t)=>{const n=new b;n.onDone(n=>{n.getPass()||r(n,t)}),n.run(...t),n.done()};return i.Report=b,i.explain=v,i.addCondition=A,i.report=E,i.config=e=>t({...n,...e},i),i}();window.refute=C}();