!function(){"use strict";const t=/([^:\s()]+:\d+(?::\d+)?)\W*(\n|$)/g;var n,e={callerInfo:function(n){return(new Error).stack.match(t)[n+1].replace(/\W*\n$/,"")||""},explain:function(t,n={}){return function t(n,e,i,r=new Map){if("string"==typeof n)return JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n||null===n)return""+n;if(void 0===n)return"<undef>";if("object"!=typeof n)return""+n;if(r.has(n)){const t="Circular="+r.get(n);return Array.isArray(n)?"[ "+t+" ]":"{ "+t+" }"}try{if(r.set(n,i),Array.isArray(n)){if(e<1)return"[...]";return"["+n.map((n,o)=>t(n,e-1,i+"["+o+"]",r)).join(", ")+"]"}const o=n.constructor&&n.constructor.name,s=o&&"Object"!==o?o+" ":"";if(e<1)return s+"{...}";return s+"{"+Object.keys(n).sort().map(o=>{const s=JSON.stringify(o);return s+":"+t(n[o],e-1,i+"["+s+"]",r)}).join(", ")+"}"}finally{r.delete(n)}}(t,n.depth||3,n.path||"$")}};const{callerInfo:i,explain:r}=e;class o{constructor(){this._count=0,this._failCount=0,this._descr=[],this._evidence=[],this._where=[],this._condName=[],this._info=[],this._nested=[],this._pending=new Set,this._onDone=[],this._done=!1}onDone(t){if("function"!=typeof t)throw new Error("onDone(): callback must be a function");return this.getDone()?t(this):this._onDone.push(t),this}onFail(t){if("function"!=typeof t)throw new Error("onDone(): callback must be a function");return this._lock(),this._onDone.push(n=>n.getPass()||t(n)),this}run(...t){this._lock();const n=t.pop();if("function"!=typeof n)throw new Error("Last argument of run() must be a function, not "+typeof n);const e=n(this,...t);return e instanceof Promise?e.then(()=>this.done()):this.done(),this}runSync(...t){this._lock();const n=t.pop();if("function"!=typeof n)throw new Error("Last argument of run() must be a function, not "+typeof n);return n(this,...t),this}setResult(t,n,e,r){this._lock();const s=++this._count;if(n&&(this._descr[s]=n),t){if(t instanceof o)if(this._nested[s]=t,t.getDone()){if(t.getPass())return;t=[]}else{const n=t;t=new Promise((t,e)=>{n.onDone(t)})}if(t instanceof Promise)return this._pending.add(s),r=r||i(2),void t.then(t=>{if(this._pending.delete(s),this._setResult(s,t,e,r),this.getDone())for(let n=this._onDone.length;n-- >0;)this._onDone[n](this)});this._setResult(s,t,e,r||i(2))}}_setResult(t,n,e,i){n&&(Array.isArray(n)||(n=[n]),this._evidence[t]=n.map(t=>s(t,1/0)),this._where[t]=i,this._condName[t]=e,this._failCount++)}info(...t){return this._lock(),this._info[this._count]||(this._info[this._count]=[]),this._info[this._count].push(t.map(t=>s(t)).join(" ")),this}done(t){if(void 0!==t&&this.onDone(t),!this._done&&(this._done=!0,!this._pending.size))for(let n=this._onDone.length;n-- >0;)this._onDone[n](this);return this}_lock(){if(this._done)throw new Error("Attempt to modify a finished contract")}getDone(){return this._done&&!this._pending.size}getPass(t){return void 0===t?0===this._failCount:t>0&&t<=this._count?!this._evidence[t]:void 0}getCount(){return this._count}last(){return this._count?!this._evidence[this._count]:void 0}getFailCount(){return this._failCount}getGhost(){const t=[];let n=0;for(let e=1;e<=this._count;e++)this._evidence[e]||this._nested[e]?(n&&t.push(n),n=0,t.push(this._nested[e]?this._nested[e].getGhost():"N")):n++;return n&&t.push(n),"r("+t.join(",")+")"}toString(){return"refute/1.1\n"+this.getLines().join("\n")}getLines(t=""){const n=[t+"r("],e=t+")";t+="    ";const i=n=>e=>t+n+" "+e;this._info[0]&&n.push(...this._info[0].map(i(";")));for(let r=1;r<=this._count;r++)n.push(...this.getLinesPartial(r,t)),this._info[r]&&n.push(...this._info[r].map(i(";")));return n.push(e),n}getLinesPartial(t,n=""){const e=[];return e.push(n+(this._pending.has(t)?"...":this._evidence[t]?"!":"")+t+(this._descr[t]?". "+this._descr[t]:".")),this._nested[t]?e.push(...this._nested[t].getLines(n)):this._evidence[t]&&(e.push(n+"    ^ Condition `"+(this._condName[t]||"check")+"` failed at "+this._where[t]),this._evidence[t].forEach(t=>{let[i,r,o]=t.match(/^([-+|] )?(.*?)\n?$/s);r||(r="| "),o.match(/\n/)?o.split("\n").forEach(t=>e.push(n+"    "+r+t)):e.push(n+"    "+r+o)})),e}toJSON(){const t=this.getCount(),n=[];for(let e=0;e<=t;e++){const t=this.getDetails(e);for(const n in t)(void 0===t[n]||Array.isArray(t[n])&&0===t[n].length)&&delete t[n];n.push(t)}return{pass:this.getPass(),count:this.getCount(),details:n}}getDetails(t){if(0===t)return{n:0,info:this._info[0]||[]};let n=this._evidence[t];return n&&!Array.isArray(n)&&(n=[n]),{n:t,name:this._descr[t]||"",pass:!n,evidence:n||[],where:this._where[t],cond:this._condName[t],info:this._info[t]||[],nested:this._nested[t],pending:this._pending.has(t)}}}function s(t,n){return"string"==typeof t?t:r(t,{depth:n})}o.prototype.explain=r,o.protocol=1.1;const h=new Set;function u(t,n,e){if("string"!=typeof t)throw new Error("Condition name must be a string");if(t.match(/^(_|get[_A-Z]|set[_A-Z])/))throw new Error("Condition name must not start with get_, set_, or _");if(!h.has(t)&&o.prototype[t])throw new Error("Method already exists in Report: "+t);if("object"!=typeof n)throw new Error("bad options");if("function"!=typeof e)throw new Error("bad implementation");const i=n.minArgs||n.args;if(!Number.isInteger(i)||i<0)throw new Error("args/minArgs must be nonnegative integer");const r=n.maxArgs||n.args||1/0;if(r!==1/0&&(!Number.isInteger(i)||r<i))throw new Error("maxArgs must be integer and greater than minArgs, or Infinity");const s=n.descrFirst||n.fun||r>10,u=!!n.hasOptions,a=r+(u?1:0);h.add(t),o.prototype[t]=function(...n){const o=s?n.shift():n.length>r&&"string"==typeof n[n.length-1]?n.pop():void 0;if(n.length>a||n.length<i)throw new Error("Condition "+t+" must have "+i+".."+a+" arguments ");return this.setResult(e(...n),o,t),this}}u("check",{args:1},t=>t),u("pass",{args:0},()=>0),u("fail",{args:0},()=>"failed deliberately"),u("equal",{args:2},(t,n)=>t===n?0:["- "+r(t),"+ "+r(n)]),u("match",{args:2},(t,n)=>null==t?[""+t,"Does not match : "+n]:(""+t).match(n)?0:["String         : "+t,"Does not match : "+n]),u("nested",{fun:1,minArgs:1},(...t)=>(new o).run(...t).done()),n={Report:o,addCondition:u,explain:r};const{addCondition:a,explain:f}=n,c={"<":(t,n)=>t<n,">":(t,n)=>t>n,"<=":(t,n)=>t<=n,">=":(t,n)=>t>=n,"==":(t,n)=>t===n,"!=":(t,n)=>t!==n},d={"<":(t,n)=>null!=t&&null!=n&&""+t<""+n,">":(t,n)=>null!=t&&null!=n&&""+t>""+n,"<=":(t,n)=>null!=t&&null!=n&&""+t<=""+n,">=":(t,n)=>null!=t&&null!=n&&""+t>=""+n,"==":(t,n)=>null!=t&&null!=n&&""+t==""+n,"!=":(t,n)=>null==t^null==n||""+t!=""+n};a("cmpNum",{args:3},(t,n,e)=>c[n](t,e)?0:[t,"is not "+n,e]),a("cmpStr",{args:3},(t,n,e)=>d[n](t,e)?0:[t,"is not "+n,e]);const l={undefined:t=>void 0===t,null:t=>null===t,number:t=>"number"==typeof t&&!Number.isNaN(t),integer:t=>Number.isInteger(t),nan:t=>Number.isNaN(t),string:t=>"string"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,object:t=>t&&"object"==typeof t&&!Array.isArray(t),array:t=>Array.isArray(t)};function p(t){return"string"==typeof t?t:"function"==typeof t?"instanceof "+(t.name||t):void 0}a("type",{args:2},(t,n)=>{Array.isArray(n)||(n=[n]);for(const e of n)if("string"==typeof e&&l[e]){if(l[e](t))return!1}else{if("function"!=typeof e||"object"!=typeof t)return"unknown value type spec: "+f(e,1);if(t instanceof e)return!1}return["- "+f(t,1),"+ "+n.map(p).join(" or ")]}),a("within",{args:3},(t,n,e)=>t<n?[t,"is below interval",[n,e]]:t>e?[t,"is above interval",[n,e]]:void 0);const{addCondition:g,Report:_}=n;g("forEach",{fun:1,args:2},(t,n)=>{if(!Array.isArray(t))return"Expected a list, found a ".typeof(t);if(t.length<1)return 0;const e=new _;return t.forEach((t,i)=>e.nested("item "+i,t,n)),e.done()}),g("ordered",{fun:1,args:2},(t,n)=>{if(!Array.isArray(t))return"Expected a list, found a ".typeof(t);if(t.length<2)return 0;const e=new _;for(let i=0;i<t.length-1;i++)e.nested("items "+i+", "+(i+1),t[i],t[i+1],n);return e.done()});const{addCondition:y,explain:m}=n;function w(t,n){return"number"==typeof n?t+"["+n+"]":n.match(/^[a-z_][a-z_0-9]*$/i)?t+"."+n:t+"["+JSON.stringify(n)+"]"}y("deepEqual",{args:2,hasOptions:!0},(function(t,n,e={}){if(e.max||(e.max=5),e.diff=[],function t(n,e,i={},r="$",o=new Map,s=new Map){if(n===e||i.max<=i.diff.length)return;if(typeof n!=typeof e)return i.diff.push([r,n,e]);if("object"!=typeof e||null===e)return i.diff.push([r,n,e]);const h=o.get(n),u=s.get(e);if(h||u){if(h===u)return;return i.diff.push([r+" (circular)",h?"Circular="+h:m(n,{depth:2}),u?"Circular="+u:m(e,{depth:2}),!0])}try{if(o.set(n,r),s.set(e,r),n.constructor!==e.constructor)return i.diff.push([r,n,e]);if(Array.isArray(e)){if(!Array.isArray(n)||n.length!==e.length)return i.diff.push([r,n,e]);for(let h=0;h<e.length&&(t(n[h],e[h],i,w(r,h),o,s),!(i.max<=i.diff.length));h++);return}const h={};Object.keys(e).forEach(t=>{h[t]=1}),Object.keys(n).forEach(t=>{h[t]=(h[t]||0)-1});for(const t in h)if(0!==h[t])return i.diff.push([r,n,e]);for(const u in e)if(t(n[u],e[u],i,w(r,u),o,s),i.max<=i.diff.length)break}finally{o.delete(n),s.delete(e)}}(t,n,e),!e.diff.length)return 0;const i=[];for(const r of e.diff)i.push("at "+r[0],"- "+(r[3]?r[1]:m(r[1],{depth:2})),"+ "+(r[3]?r[2]:m(r[2],{depth:2})));return i}));const{Report:b,addCondition:A,explain:v}=n,E=(...t)=>(new b).run(...t).done();var C=function t(n={},e){const i=n.onFail||(t=>{throw new Error(t.toString())}),r=n.skip?()=>{}:(...t)=>{const n=new b;n.onDone(n=>{n.getPass()||i(n,t)}),n.run(...t),n.done()};return r.Report=b,r.explain=v,r.addCondition=A,r.report=E,r.config=e=>t({...n,...e},r),r}();window.refute=C}();